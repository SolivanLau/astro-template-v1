---
// Components and Scripts
import PageLayout from "@layouts/PageLayout.astro";
import Header from "@layouts/Header.astro";
import Title from "@components/Title.astro";
import cmsFetch from "@assets/scripts/cms/cmsFetch";
import { renderBlock } from "@assets/scripts/cms/blockRenderer";
import BlockRenderer from "@components/BlockRenderer.astro";
// Assets
import headerBg from "@images/home-bg-desktop.webp";

// CMS Query
const querParameters = {
    populate: {
        header: {
            populate: {
                title: "*",
                backgroundImage: "*",
                backgroundImageMobile: "*",
            },
        },
        missionStatement: {
            populate: {
                title: "*",
                text: "*",
                imageBanner: "*",
            },
        },
        services: {
            populate: {
                title: "*",
                text: "*",
                featuredEvents: "*",
            },
        },
        ctaBanner: {
            populate: {
                text: "*",
                link: "*",
            },
        },
        team: {
            populate: {
                title: "*",
                text: "*",
                memberCard: "*",
            },
        },
    },
};

const pageQuery = await cmsFetch("about-page", querParameters);
const data = pageQuery.attributes;

const { header, missionStatement, services, ctaBanner, team } = pageQuery.attributes;
---

<PageLayout>
    <Header
        backgroundImgPath={headerBg}
        title={header.title.title || "About Us"}
        subtitle={header.title.subtitle || ""}
    />
    <main>
        <!-- MISSION SECTION -->
        <section class="mission">
            <div class="wrapper">
                <article class="mission__text">
                    <Title
                        title={missionStatement.title.title ||
                            "Championing Local Musicians & Composers"}
                        topper={missionStatement.title.subtitle || "Our Mission"}
                    />

                    <BlockRenderer html={missionStatement.text}>
                        <p>this is backup content</p>
                    </BlockRenderer>
                </article>
            </div>
        </section>

        <!-- SERVICES -->
        <section class="services">
            <div class="wrapper">
                <Title
                    title={services.title.title || "Premiering Canadian Wind Music"}
                    topper={services.title.subtitle || "What We Do"}
                />

                <BlockRenderer html={services.text}>
                    <p>
                        The collective works with early career musicians to write, workshop, record,
                        and premeire wind compositions!
                    </p>
                </BlockRenderer>
            </div>
        </section>
    </main>
</PageLayout>

<script define:vars={{ data, header, missionStatement, services, ctaBanner, team }}>
    // console.log(data);
    console.log(missionStatement);
</script>
